[["index.html", "EDAV Group3 Final Project Chapter 1 Introduction", " EDAV Group3 Final Project Xinwen Miao, Yilan Jiang, Huiqian Yu, Diyue Gu 2020-12-17 Chapter 1 Introduction "],["data.html", "Chapter 2 Data 2.1 Describe the data sources: 2.2 Basic information about the dataset: 2.3 Describe any issues with the data:", " Chapter 2 Data 2.1 Describe the data sources: 2.1.1 Describe the data sources: Huiqian is responsible for collecting data. The aim of this project is to analyze the air pollutants over the U.S. The data was collect from CASTNET: Clean Air Status and Trends Network(https://java.epa.gov/castnet/clearsession.do), which is a national monitoring network established to assess trends in pollutant concentrations, atmospheric deposition, and ecological effects due to changes in air pollutant emissions. CASTNET offers filter pack data which are reported for the time interval which the filter was exposed. The data set is easily accessible through custom report. We chose weekly ambient concentrations of SO2 and HNO3 gases, and SO4, NO3, NH4 and base cation concentrations for particles as measured by open-face filter packs from 2010 to 2020 all over the U.S. 2.2 Basic information about the dataset: raw_data &lt;- read.csv(&quot;./data/Filter Pack Concentrations - Weekly.csv&quot;) colnames(raw_data) ## [1] &quot;SITE_ID&quot; &quot;TYPE&quot; &quot;DATEON&quot; &quot;DATEOFF&quot; &quot;TSO4&quot; &quot;TNO3&quot; ## [7] &quot;TNH4&quot; &quot;CA&quot; &quot;MG&quot; &quot;NA.&quot; &quot;K&quot; &quot;CL&quot; ## [13] &quot;NSO4&quot; &quot;NHNO3&quot; &quot;WSO2&quot; &quot;WNO3&quot; &quot;TOTAL_SO2&quot; &quot;TOTAL_NO3&quot; ## [19] &quot;FLOW_VOLUME&quot; &quot;VALID_HOURS&quot; &quot;COMMENT_CODES&quot; &quot;STD2LOCAL_CF&quot; &quot;TEMP_SOURCE&quot; &quot;QA_CODE&quot; ## [25] &quot;UPDATE_DATE&quot; nrow(raw_data) ## [1] 49124 ncol(raw_data) ## [1] 25 The raw data has following 25 columns and 49124 rows: SITE_ID: Site identification code. TYPE: Sample type code. DATEON: Date and time sample collection began, Local Standard Time; mm/dd/yyyy hh:mm:ss. DATEOFF: Date and time sample collection ended, Local Standard Time; mm/dd/yyyy hh:mm:ss. TSO4: Sulfate (SO4) concentration from Teflon filter; ug/m^3. TNO3: Nitrate (NO3) concentration from Teflon filter; ug/m^3. TNH4: Ammonium (NH4) concentration from Teflon filter; ug/m^3. CA: Calcium (Ca) concentration from Teflon filter; ug/m^3. MG: Magnesium (Mg) concentration from Teflon filter; ug/m^3. NA: Sodium (Na) concentration from Teflon filter; ug/m^3. K: Potassium (K) concentration from Teflon filter; ug/m^3. CL: Chloride (Cl) concentration from Teflon filter; ug/m^3. NSO4: Sulfate (SO4) concentration from Nylon filter; ug/m^3. NHNO3: Nitric acid (NO3) concentration from Nylon filter; ug/m^3. WSO2: Sulfur dioxide (SO2) concentration from Whatman filter; ug/m^3. WNO3: Nitrate (NO3) concentration from Whatman filter; ug/m^3. TOTAL_SO2: Total sulfur dioxide (SO2) concentration calculated from [wso2]+0.667*nso4]; ug/m^3. TOTAL_NO3: Total nitrate (NO3) concentration calculated from [tno3]+0.9841*[nhno3]; ug/m^3. 19: FLOW_VOLUME: Flow volume; m^3. VALID_HOURS: Valid hours during sampling period COMMENT_CODES: Comment codes separated by spaces STD2LOCAL_CF: Factor used to convert atmospheric concentrations from standard to local conditions TEMP_SOURCE: Source of mean temperature used in conversion factor QA_CODE: Quality assurance level of the record. (see QAPP for definition of quality assurance levels) UPDATE_DATE: Date and time of last record update. 2.3 Describe any issues with the data: We need to clean raw data and extract necessary columns: SITE_ID, DATEOFF, TSO4, TNO3, TNH4, CA, MG, NA, K, CL, NSO4, NHNO3, WSO2, WNO3. The date information display in DATEOFF, mm/dd/yyy hh:mm:ss, we need to convert it into DATE mm/dd/yyyy format. The location information from raw data is SITE_ID, which is site identification code used by CASTNET. To transform SITE_ID into general geographical location, we download site information data from CASTNET: https://java.epa.gov/castnet/epa_jsp/prepackageddata.jsp, and further join the information. site_data &lt;- read.csv(&quot;./data/site.csv&quot;) colnames(site_data) ## [1] &quot;SITE_ID&quot; &quot;SITE_NUM&quot; &quot;SITE_NAME&quot; &quot;ACTIVE&quot; &quot;INACTIVE&quot; &quot;AGENCY&quot; ## [7] &quot;STATE&quot; &quot;COUNTY&quot; &quot;TIME_ZONE&quot; &quot;LATITUDE&quot; &quot;LONGITUDE&quot; &quot;ELEVATION&quot; ## [13] &quot;MAPID&quot; &quot;LAND_USE&quot; &quot;TERRAIN&quot; &quot;MLM&quot; &quot;NADP_ID&quot; &quot;NADP_DISTANCE&quot; ## [19] &quot;UPDATE_DATE&quot; The site data has following columns: SITE_ID:Site identification code SITE_NUM: Numeric unique site identification SITE_NAME: Site name ACTIVE: Sampling operations currently being conducted at site; site is inactive if NULL. INACTIVE: Sampling operations that have previously been conducted at the site but are not currently being performed AGENCY: Operating agency STATE: State abbreviation COUNTY: County TIME_ZONE: Local time zone of site LATITUDE: Latitude; decimal degrees LONGITUDE: Longitude; decimal degrees ELEVATION: Elevation; m MAPID: USGS 7-1/2 min. map name. LAND_USE: Primary land use TERRAIN: Terrain surrounding site MLM: Does site conform to assumptions of MLM? NADP_ID: ADP site code NADP_DISTANCE: Distance to nearest NADP site; km UPDATE_DATE: Date and time of last record update We don’t need all of these columns, we only need extract SITE_ID, STATE, CONTRY, LATITUDE, LONGITUDE, ELEVATION information. "],["data-cleaning.html", "Chapter 3 Data Cleaning 3.1 Data Source 1 3.2 Data Source 2", " Chapter 3 Data Cleaning library(tidyr) library(dplyr) library(usmap) 3.1 Data Source 1 In the data cleaning stage, we deleted unrelated columns from the original data set. For air pollutant data, we first merged two datasets by their SITE_ID to add location information into the air pollution info. Also, we changed the date time format into desired date type. site&lt;-read.csv(&quot;./data/site.csv&quot;) raw&lt;-read.csv(&quot;./data/Filter Pack Concentrations - Weekly.csv&quot;) site1&lt;- site %&gt;% select(SITE_ID,STATE,COUNTY,LATITUDE,LONGITUDE,ELEVATION) data &lt;- full_join(site1,raw,by=&#39;SITE_ID&#39;) %&gt;% select(-WNO3,-QA_CODE,-DATEON,-COMMENT_CODES) data$date_off &lt;- as.Date(data$DATEOFF, &quot;%m/%d/%Y&quot;) data$update_date &lt;- as.Date(data$UPDATE_DATE, &quot;%m/%d/%Y&quot;) data &lt;- data %&gt;% select(-UPDATE_DATE,-DATEOFF) Next, we added a column called “REGION” into the pollution data so that each state can be classified by one of three larger regions (“east”, “middle”, “west”). In terms of how we group each state, please refer to Census Regions and Divisions of United States. # First generate a region_table # reference: https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf east_abbr &lt;- c(.new_england, .east_north_central, .mid_atlantic, .east_south_central, .south_atlantic) west_abbr &lt;- c(.west_north_central, .west_south_central) middle_abbr &lt;- c(.mountain, .pacific) region_table &lt;- data.frame(&quot;REGION&quot;=c(rep(&#39;east&#39;, length(east_abbr)), rep(&#39;middle&#39;, length(middle_abbr)), rep(&#39;west&#39;, length(west_abbr))), &quot;STATE&quot; = c(east_abbr, middle_abbr, west_abbr)) data &lt;- left_join(data, region_table, by=&#39;STATE&#39;) head(data) ## SITE_ID STATE COUNTY LATITUDE LONGITUDE ELEVATION TYPE TSO4 TNO3 TNH4 CA MG NA. ## 1 ABT147 CT Windham 41.84046 -72.01037 202 C 0.8974 0.6695 0.4103 0.0340 0.0077 0.2689 ## 2 ABT147 CT Windham 41.84046 -72.01037 202 C 2.5815 1.2309 1.1158 0.0624 0.0204 0.2784 ## 3 ABT147 CT Windham 41.84046 -72.01037 202 C 1.2745 0.6865 0.4627 0.0467 0.0570 0.6598 ## 4 ABT147 CT Windham 41.84046 -72.01037 202 C 1.3667 0.6192 0.5233 0.0897 0.0218 0.3470 ## 5 ABT147 CT Windham 41.84046 -72.01037 202 C 1.2823 0.9395 0.5222 0.1039 0.0234 0.4447 ## 6 ABT147 CT Windham 41.84046 -72.01037 202 C 0.9568 0.9474 0.4787 0.1021 0.0177 0.2827 ## K CL NSO4 NHNO3 WSO2 TOTAL_SO2 TOTAL_NO3 FLOW_VOLUME VALID_HOURS STD2LOCAL_CF TEMP_SOURCE ## 1 0.0378 0.2320 0.5517 0.5856 1.3545 1.7225 1.2458 13.6400 167 0.9187067 sa ## 2 0.0561 0.1138 0.7818 1.2644 2.8101 3.3315 2.4752 13.9685 168 0.9353095 sa ## 3 0.0624 0.7857 0.6660 1.0390 1.1372 1.5814 1.7090 14.0765 168 0.9436235 sa ## 4 0.0420 0.3637 0.5813 0.8364 2.4504 2.8382 1.4424 13.7188 168 0.9180029 sa ## 5 0.0641 0.3976 0.5874 1.1446 1.9528 2.3446 2.0658 13.6624 167 0.9200917 sa ## 6 0.0853 0.2880 0.6177 0.7192 1.6457 2.0578 1.6552 13.9217 168 0.9321208 sa ## date_off update_date REGION ## 1 2010-01-12 2010-07-01 east ## 2 2010-01-19 2010-07-01 east ## 3 2010-01-26 2010-07-01 east ## 4 2010-02-02 2010-07-01 east ## 5 2010-02-09 2010-07-01 east ## 6 2010-02-16 2010-07-01 east write.csv(data, file=&quot;./data/processedData.csv&quot;) 3.2 Data Source 2 NOTE from data source website: The following suppression rules are implemented in the ASCII files. –Rates and Counts are suppressed if fewer than 16 cases were reported in a specific category (‘~’ assigned to count, rate, LCI, and UCI); –Rate and Counts are suppressed if state requested suppressions for race and ethnicity (‘-’ assigned to count, rate, LCI, and UCI); –Within each Race, CancerSite, Area, RateType and DataType, “Male” or “Female” counts are suppressed (supplementarily) if the counterpart sex (“Female” or “Male”) is suppressed. Leave “Male and Female” count unchanged (‘+’ assigned to count due to supplementary suppression). load(&quot;./data/RawCancerData.RData&quot;) head(data) ## STATE AREA AGE_ADJUSTED_CI_LOWER AGE_ADJUSTED_CI_UPPER ## 1 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## 2 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## 3 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## 4 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## 5 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## 6 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ ## AGE_ADJUSTED_RATE COUNT EVENT_TYPE POPULATION RACE SEX SITE YEAR ## 1 ~ ~ Incidence 5458 All Races Female All Cancer Sites Combined 2013-2017 ## 2 ~ ~ Mortality 5458 All Races Female All Cancer Sites Combined 2013-2017 ## 3 ~ ~ Incidence 5458 All Races Female Brain and Other Nervous System 2013-2017 ## 4 ~ ~ Mortality 5458 All Races Female Brain and Other Nervous System 2013-2017 ## 5 ~ ~ Incidence 5458 All Races Female Cervix 2013-2017 ## 6 ~ ~ Mortality 5458 All Races Female Cervix 2013-2017 ## CRUDE_CI_LOWER CRUDE_CI_UPPER CRUDE_RATE ## 1 ~ ~ ~ ## 2 ~ ~ ~ ## 3 ~ ~ ~ ## 4 ~ ~ ~ ## 5 ~ ~ ~ ## 6 ~ ~ ~ temp &lt;- data %&gt;% select(-AGE_ADJUSTED_CI_LOWER, -AGE_ADJUSTED_CI_UPPER, -CRUDE_CI_LOWER, -CRUDE_CI_UPPER) %&gt;% filter(RACE==&quot;All Races&quot;,SITE==&quot;Lung and Bronchus&quot;) head(temp) ## STATE AREA AGE_ADJUSTED_RATE COUNT EVENT_TYPE POPULATION ## 1 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Incidence 5458 ## 2 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Mortality 5458 ## 3 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Incidence 11499 ## 4 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Mortality 11499 ## 5 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Incidence 16957 ## 6 AK AK: Aleutians East Borough (02013) - 1994+ ~ ~ Mortality 16957 ## RACE SEX SITE YEAR CRUDE_RATE ## 1 All Races Female Lung and Bronchus 2013-2017 ~ ## 2 All Races Female Lung and Bronchus 2013-2017 ~ ## 3 All Races Male Lung and Bronchus 2013-2017 ~ ## 4 All Races Male Lung and Bronchus 2013-2017 ~ ## 5 All Races Male and Female Lung and Bronchus 2013-2017 ~ ## 6 All Races Male and Female Lung and Bronchus 2013-2017 ~ save(temp, file=&quot;./data/DiseaseProcessedData.RData&quot;) "],["missing-values.html", "Chapter 4 Missing values", " Chapter 4 Missing values "],["data-source-1-1.html", "Chapter 5 ## Data Source 1 5.1 Data Source 2", " Chapter 5 ## Data Source 1 In the raw dataset, each row contains at least one missing value as the column called “WNO3” is empty. This column was supposed to record nitrate (NO3) concentration from Whatman filter. However, since the U.S. Environmental Protection Agency records NO3 concentration from Teflon filter only, we removed the entire column. After removing “WNO3” and some other redundant columns, we ends up with 1337 rows with at least one missing values, 16596 total missing values, and the percentage of missing values over the entire dataset is around 1.78 percent. After that, we would like to know if all variables have the same percentage of missing values. Therefore, we sum up missing values by column as shown below. library(dplyr) data &lt;- read.csv(file=&#39;./data/Filter_Pack_Concentrations_W.csv&#39;) remove_columns &lt;- c(&#39;WNO3&#39;, &#39;QA_CODE&#39;, &#39;DATEON&#39;, &#39;COMMENT_CODES&#39;, &#39;TOTAL_NO3&#39;, &#39;UPDATE_DATE&#39;) dt &lt;- select(data, -remove_columns) colSums(is.na(data)) ## SITE_ID TYPE DATEON DATEOFF TSO4 TNO3 TNH4 ## 0 0 0 0 1220 1220 1220 ## CA MG NA. K CL NSO4 NHNO3 ## 1225 1223 1225 1298 1230 1222 1222 ## WSO2 WNO3 TOTAL_SO2 TOTAL_NO3 FLOW_VOLUME VALID_HOURS COMMENT_CODES ## 1246 49124 1234 1212 902 892 0 ## STD2LOCAL_CF TEMP_SOURCE QA_CODE UPDATE_DATE ## 17 0 0 0 Notice that each pollutant concentration variables contain almost the same percentage of missing values. We tried to extract missing patterns using mi::missing_data.frame(). To save memory, we only input the first 20,000 data. #library(mi) #library(betareg) #x &lt;- missing_data.frame(dt[1:20000,]) #image(x) The result is consistent to what we found before, [“TSO4”, “TNO3”, “TNH4”, “CA”, “MG”, “TSO4”] have the same missingness pattern. Also we found out that within each “Side_ID”, the number of missing values is almost the same across each pollutant. We will further work on understanding if these is any patterns between missing values and date or locations. At this point, we would not directly remove these missing points as some missing values may link to other groups in the data. 5.1 Data Source 2 "],["results.html", "Chapter 6 Results 6.1 Packages 6.2 Data 6.3 How does air pollution spread over the past ten years?", " Chapter 6 Results 6.1 Packages All packages we have used in this section. library(dplyr) library(tidyverse) library(dygraphs) library(xts) library(cowplot) library(GGally) 6.2 Data Before moving on, let us draw some insights from each pollutant concentration over the past ten years. data = read.csv(file=&#39;./data/processedData.csv&#39;) data &lt;- data %&gt;% na.omit() data &lt;- data %&gt;% rename(NO3=TOTAL_NO3, SO2=TOTAL_SO2) data$date = as.Date(data$date_off) data$year &lt;- format(as.Date(data$date, &quot;%F&quot;), &quot;%Y&quot;) data$month &lt;- format(as.Date(data$date, &quot;%F&quot;), &quot;%m&quot;) data %&gt;% select(SO2, NO3) %&gt;% summary() ## SO2 NO3 ## Min. : 0.0464 Min. : 0.0443 ## 1st Qu.: 0.2588 1st Qu.: 0.5745 ## Median : 0.4742 Median : 1.0204 ## Mean : 0.8527 Mean : 1.2778 ## 3rd Qu.: 0.9528 3rd Qu.: 1.6335 ## Max. :22.1271 Max. :14.8690 Notes: The mean and the median for each pollutant, especially SO2 is far apart. It implies that median might be a better representation to each pollutant distribution. The largest observation of each pollutant is hugely deviated from mean and median. We need to visualize the distribution of each pollutant more carefully to eliminate any possible outliers. That is what we will do in the next section. 6.2.1 Data Distribution In order to visualize the distribution of each pollutant, we constructed boxplots. Moreover, since environmental factors vary across the entire nation, we faceted each boxplot by regions (east, middle, west) to see how the concentration of each pollutant varies by regions. For further information about how we split the regions, please refer to previous section called Data Cleaning. Since most data values are lower than 1, we transform all concentration values with log scale to better visualize them. selected_cols &lt;- c(&quot;date&quot;, &quot;REGION&quot;,&quot;STATE&quot;, &quot;COUNTY&quot;,&quot;VALID_HOURS&quot;,&quot;SO2&quot;, &quot;NO3&quot;) new_data &lt;- data %&gt;% select(selected_cols) tidy_data &lt;- pivot_longer(new_data, cols=c(&quot;SO2&quot;, &quot;NO3&quot;), names_to = &quot;Pollutant&quot;, values_to = &quot;Concentration&quot;, values_drop_na = TRUE) pollutants &lt;- c(&quot;SO2&quot;, &quot;NO3&quot;) ggplot(tidy_data, aes(x=reorder(Pollutant, -Concentration, median), y = Concentration)) + geom_boxplot(fill=&quot;#48C9B0&quot;, color = &quot;#117864&quot;) + coord_flip() + scale_y_log10() + facet_grid(rows=vars(REGION))+ xlab(&quot;Pollutant&quot;) + ylab(&quot;Concentration&quot;) + ggtitle(&quot;The Distribution of each Air Pollutant faceted by Regions (SO2, NO3)&quot;) Remarks: For both pollutants, the median value is higher in eastern area than the other two regions. In particular, large numbers of high values emerge in that region. Further investigation is needed. There are lots of outliers in each pollutant data. This observation suggests that we should not delete these outliers since they become a commonplace in this analysis. 6.3 How does air pollution spread over the past ten years? 6.3.1 Time Series of SO2 and NO3 Across the Nation Here we plot two dygraphs, one for each pollutant, to visualize the overall distribution in the past ten years. Feel free to play with them and draw some insights. time_series_obj &lt;- xts(x = data$SO2, order.by = data$date) dygraph(time_series_obj, main = &quot;Sulfur Dioxide Trend in US&quot;, xlab = &quot;Date&quot;, ylab = &quot;SO2 (ug/m^3)&quot;) %&gt;% dyRangeSelector() time_series_obj &lt;- xts(x = data$NO3, order.by = data$date) dygraph(time_series_obj, main = &quot;Nitrate Trend in US&quot;, xlab = &quot;Date&quot;, ylab = &quot;NO3 (ug/m^3)&quot;) %&gt;% dyRangeSelector() The overall trends of SO2 and NO3 are similar as they both peak in January 2011 and February 2014. The only different is that the overall trend of SO2 concentration decreases from year to year, while the trend of NO3 remains unchanged. The Environmental Projection Agency and other related organizations have make lots of effort in regulating the emission of SO2 and many common pollutants such as NO2, PM25 since 1970. However, the air pollution problem remains challenging as there are a lot other toxic pollutants such as NO3. Of course, you may complain the time series above are too dense to analyze. In the next section, we will aggregate the concentration of SO2 and NO3 by month to oberve any secular and cyclical trend over time. 6.3.2 Monthly Time Series Here, we average SO2 and NO3 by months and get the following two monthly plots. data_month &lt;- data %&gt;% mutate(month_year = paste(year, month, &#39;01&#39;, sep=&#39;-&#39;)) %&gt;% group_by(month_year) %&gt;% summarise(aver_SO2 = mean(SO2), aver_NO3 = mean(NO3)) %&gt;% ungroup() plot_SO2 &lt;- ggplot(data_month, aes(x=as.Date(month_year, format=&quot;%F&quot;), y=aver_SO2)) + geom_line(color=&#39;#117864&#39;) + scale_x_date(breaks = seq(as.Date(&quot;2010-01-01&quot;), as.Date(&quot;2020-08-01&quot;), by=&quot;12 months&quot;), date_labels=&quot;%Y&quot;) + xlab(&quot;Date&quot;) + ylab(&quot;SO2 (ug/m^3)&quot;) + ggtitle(&quot;Monthly Average Sulfer Dioxide Concentration&quot;) plot_NO3 &lt;- ggplot(data_month, aes(x=as.Date(month_year, format=&quot;%F&quot;), y=aver_NO3)) + geom_line(color=&#39;#117864&#39;) + scale_x_date(breaks = seq(as.Date(&quot;2010-01-01&quot;), as.Date(&quot;2020-08-01&quot;), by=&quot;12 months&quot;), date_labels=&quot;%Y&quot;) + xlab(&quot;Date&quot;) + ylab(&quot;NO3 (ug/m^3)&quot;) + ggtitle(&quot;Monthly Average Nitrate Concentration&quot;) plot_grid(plot_SO2, plot_NO3, nrow = 2) Remarks: Based on the monthly plots above, we may conclude that the overall SO2 concentration decreases year to year. In particular, it decreases significantly in 2020. We suspect part of the reason might be due to Covid-19. In the next section, we will briefly investigate possible effects of Covid-19 on SO2 emission level. On the other hand, the overall NO3 concentration slightly diminished from 2010 to 2014 and then remain high since then. In addition to common pollutants like SO2, there are actually lots of toxic pollutants similar to NO3 that are challenging our environment. We can observe cyclic pattern in both plots above. Then the next question we ask is what is causing the cyclical pattern? A rational guess we have is monthly effect. Therefore, we plot monthly sub-series of a time series for each pollutant as follows. data_month$month_year = as.Date(data_month$month_year) SO2 &lt;- ts(data_month$aver_SO2, start=c(2010, 1), end=c(2020, 8), frequency = 12) month_SO2 &lt;- monthplot(SO2, main=&quot;Sulfer Dioxide Trend, grouped by month&quot;) NO3 &lt;- ts(data_month$aver_NO3, start=c(2010, 1), end=c(2020, 8), frequency = 12) month_NO3 &lt;- monthplot(NO3, main=&quot;Nitrate Trend, grouped by month&quot;) Based on the two plots above, we observe that monthly (for seasonal) effect causes the cyclical pattern of SO2 since after we facet the plot by month, the overall trends are similar. And the secular trend of SO2 peak in January and February, which makes sense since winter season requires heaters. On the other hand, monthly effect does not entirely cause the cyclical pattern of NO3 as observed above since the overall trends are still different. 6.3.3 Did Covid-19 lockdown significantly reduce air pollution in New York State? In India and China, researchers found out that air quality improves significantly in urban districts during lockdown. If you want to dive deeper into this research, please refer to Comparative study on air quality status in India and Chinese cities before and during the COVID-19 lockdown period. By the same interest, we did a brief investigations on the impact of COVID-19 lockdown to the two pollutants, SO2 and NO3. It is unrealistic to investigate the impact of Covid-19 to air pollution across the entire nation since each state responsed differently to the pandemic. Therefore, we decided to choose New York State as a representative. The New York State government began with a full lockdown from March 2020 to April 2020 in response to Covid-19 Pandemic. In the following plot, we created a monthly concentration plot by year for each pollutant. Notice in March and April, the SO2 and NO3 concentration level did diminish but not significantly. Therefore, we may conclude that in terms of SO2 and NO3, Covid-19 lockdown did not reduce air pollution significantly. Further investigation is needed on other pollutants. new_data &lt;- data %&gt;% filter(data$STATE==&#39;NY&#39;) %&gt;% mutate(month_year = paste(year, month, &#39;01&#39;, sep=&#39;-&#39;)) %&gt;% group_by(month_year) %&gt;% summarise(aver_SO2 = mean(SO2), aver_NO3 = mean(NO3)) %&gt;% ungroup() %&gt;% mutate( date = as.Date(month_year), xaxis_year = update(date, year = 1), year = format(as.Date(date, format=&quot;%F&quot;), &quot;%Y&quot;) ) ggplot(new_data, aes(xaxis_year, SO2, color = year)) + scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;) + geom_line() + xlab(&quot;month&quot;) + ylab(&quot;SO2 (ug/m^3)&quot;) + ggtitle(&quot;Monthly SO2 in New York State across each year&quot;) ggplot(new_data, aes(xaxis_year, NO3, color = year)) + scale_x_date(date_breaks = &quot;1 month&quot;, date_labels = &quot;%b&quot;) + geom_line() + xlab(&quot;month&quot;) + ylab(&quot;NO3 (ug/m^3)&quot;) + ggtitle(&quot;Monthly NO3 in New York State across each year&quot;) #group by state, calculate mean SO2, mean NO3over past 10 years dataState&lt;- data%&gt;%group_by(STATE)%&gt;%summarise(SO2 = mean(SO2), NO3=mean(NO3)) library(tools) library(micromap) data(&quot;USstates&quot;) statePolys &lt;- create_map_table(USstates, IDcolumn = &quot;ST&quot;) lmplot(stat.data = dataState, map.data = statePolys, panel.types = c(&#39;dot_legend&#39;, &#39;labels&#39;, &#39;dot&#39;, &#39;map&#39;), panel.data = list(NA, &#39;STATE&#39;,&#39;SO2&#39;, NA), ord.by = &#39;SO2&#39;, rev.ord = TRUE, grouping = 5, colors = brewer.pal(5, &quot;Set1&quot;), median.row = TRUE, map.link = c(&#39;STATE&#39;, &#39;ID&#39;), map.color2 = &quot;white&quot;, panel.att = list( list(1, point.type=20, point.border=TRUE), list(2, header = &quot;STATE&quot;, panel.width = 0.2, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2, graph.grid.color = &quot;grey99&quot;, align = &quot;left&quot;), list(3, header = &quot;Mean SO2 Pollution Amount&quot;, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2, xaxis.title = &#39;ug/m^3&#39;), list(4, header = &#39;Geographical Location&#39;, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2) )) library(tools) library(micromap) data(&quot;USstates&quot;) statePolys &lt;- create_map_table(USstates, IDcolumn = &quot;ST&quot;) lmplot(stat.data = dataState, map.data = statePolys, panel.types = c(&#39;dot_legend&#39;, &#39;labels&#39;, &#39;dot&#39;, &#39;map&#39;), panel.data = list(NA, &#39;STATE&#39;,&#39;NO3&#39;, NA), ord.by = &#39;NO3&#39;, rev.ord = TRUE, grouping = 5, colors = brewer.pal(5, &quot;Set1&quot;), median.row = TRUE, map.link = c(&#39;STATE&#39;, &#39;ID&#39;), map.color2 = &quot;white&quot;, panel.att = list( list(1, point.type=20, point.border=TRUE), list(2, header = &quot;STATE&quot;, panel.width = 0.2, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2, graph.grid.color = &quot;grey99&quot;, align = &quot;left&quot;), list(3, header = &quot;Mean NO3 Pollution Amount&quot;, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2, xaxis.title = &#39;ug/m^3&#39;), list(4, header = &#39;Geographical Location&#39;, panel.header.face = &quot;bold&quot;, panel.header.size = 1.2) )) library(choroplethr) dataState&lt;- data%&gt;%group_by(STATE)%&gt;%summarise(SO2 = mean(SO2), NO3=mean(NO3)) #mean so2 by state dataStateSO2&lt;-dataState%&gt;%select(STATE,SO2) dataStateSO2&lt;-dataStateSO2%&gt;%rename(region=STATE, value=SO2) dataStateSO2$region&lt;-tolower(state.name[match(dataStateSO2$region, state.abb)]) state_choropleth(dataStateSO2,title=&quot;Mean SO2 Amount Over 10 Years by State&quot;, legend=&quot;SO2 Amount by state&quot;)+ scale_fill_brewer(palette=8) #mean NO3 by state dataStateNO3&lt;-dataState%&gt;%select(STATE,NO3) dataStateNO3&lt;-dataStateNO3%&gt;%rename(region=STATE, value=NO3) dataStateNO3$region&lt;-tolower(state.name[match(dataStateNO3$region, state.abb)]) state_choropleth(dataStateNO3,title=&quot;Mean NO3 Amount Over 10 Years by State&quot;, legend=&quot;NO3 Amount by state&quot;)+ scale_fill_brewer(palette=8) dataMosaic &lt;- gather(dataState,key = &#39;pollutant&#39;,value = concentration, -STATE) ggplot(data = dataMosaic, aes(x = reorder(STATE, -concentration), y = concentration, fill = pollutant,order = pollutant)) + geom_bar(stat = &quot;identity&quot;) + coord_flip() + ggtitle(&quot;Pollutant distribution by states&quot;) ##Combine two datasets Since cancer data are from year 2013-2017, we use the mean of the amount of SO2 and NO3 from 2013-2017 as the indicator. load(&quot;./data/DiseaseProcessedData.RData&quot;) data &lt;- read.csv(&quot;./data/processedData.csv&quot;) data &lt;- data %&gt;% na.omit() cancer_data &lt;- temp%&gt;% na.omit() data$date = as.Date(data$date_off) data$year &lt;- format(as.Date(data$date, &quot;%F&quot;), &quot;%Y&quot;) data_year &lt;- data %&gt;% filter((year &lt;= 2017) &amp; (year &gt;= 2013)) cancer_data$COUNT &lt;- as.numeric(as.character(cancer_data$COUNT)) cancer_data$POPULATION &lt;- as.numeric(as.character(cancer_data$POPULATION)) incidence_data &lt;- cancer_data%&gt;% filter(EVENT_TYPE==&quot;Incidence&quot;) mortality_data &lt;-cancer_data%&gt;% filter(EVENT_TYPE==&quot;Mortality&quot;) #Incident count totalIncidence_count &lt;- incidence_data %&gt;% filter(SEX==&quot;Male and Female&quot;)%&gt;% group_by(STATE)%&gt;% summarise(TotalIncidence = sum(COUNT, na.rm = TRUE)) FemaleIncidence_count &lt;- incidence_data %&gt;% filter(SEX==&#39;Female&#39;)%&gt;% group_by(STATE)%&gt;% summarise(FemaleIncidence = sum(COUNT, na.rm = TRUE)) MaleIncidence_count &lt;- incidence_data %&gt;% filter(SEX==&#39;Male&#39;)%&gt;% group_by(STATE)%&gt;% summarise(MaleIncidence = sum(COUNT, na.rm = TRUE)) #populations pop &lt;- incidence_data %&gt;% filter(SEX==&quot;Male and Female&quot;)%&gt;% group_by(STATE)%&gt;% summarise(TotalPop = sum(POPULATION, na.rm = TRUE)) Femalepop &lt;- incidence_data %&gt;% filter(SEX==&quot;Female&quot;)%&gt;% group_by(STATE)%&gt;% summarise(TotalFPop = sum(POPULATION, na.rm = TRUE)) Malepop &lt;- incidence_data %&gt;% filter(SEX==&quot;Male&quot;)%&gt;% group_by(STATE)%&gt;% summarise(TotalMPop = sum(POPULATION, na.rm = TRUE)) #Combine dataframe PopData &lt;- merge(pop,Femalepop,by =&quot;STATE&quot;)%&gt;% merge(Malepop,by =&quot;STATE&quot;) CountData &lt;- merge(totalIncidence_count,FemaleIncidence_count,by =&quot;STATE&quot;)%&gt;% merge(MaleIncidence_count,by =&quot;STATE&quot;) combined &lt;- merge(PopData,CountData,by =&quot;STATE&quot;) %&gt;% mutate(TotalRate = 100*(TotalIncidence/TotalPop))%&gt;% mutate(FemaleRate = 100*(FemaleIncidence/TotalFPop))%&gt;% mutate(MaleRate = 100*(MaleIncidence/TotalMPop)) #pollutants so2 &lt;- data_year %&gt;% group_by(STATE) %&gt;% summarise(TotalSO2 = mean(TOTAL_SO2, na.rm = TRUE)) no3 &lt;- data_year %&gt;% group_by(STATE) %&gt;% summarise(TotalNO3 = mean(TOTAL_NO3, na.rm = TRUE)) region&lt;-data%&gt;% select(STATE,REGION)%&gt;% distinct(.keep_all = FALSE) #Cancer and pollutants df newdata&lt;- merge(x = combined, y = so2, by = &quot;STATE&quot;, all.x = TRUE) newdata&lt;- merge(x = newdata, y = no3, by = &quot;STATE&quot;, all.x = TRUE)%&gt;% na.omit() newdata&lt;- merge(x = newdata, y = region, by = &quot;STATE&quot;, all.x = TRUE)%&gt;% na.omit() newdata$REGION&lt;-as.character(newdata$REGION) ##Scatter plots ggplot(newdata, aes(TotalSO2,TotalRate)) +geom_point(alpha =.5, size =1) +theme_classic(14) + ggtitle(&quot;Scatter Plot of Mean SO2 and TotalRate&quot;)+ xlab(&quot;meanSO2&quot;) ggplot(newdata, aes(TotalNO3, TotalRate)) +geom_point(alpha =.5, size =1) +theme_classic(14)+ ggtitle(&quot;Scatter Plot of Mean NO3 and TotalRate&quot;)+ xlab(&quot;meanNO3&quot;) * Remarks: + The scatter plots shows that there are no state with high SO2 and low incident rate and no state with low SO2 and high incident rate. + The NO3 plot doesn’t show a clear pattern. ##Cleveland dot plots of all gender cancer rate and SO2, NO3 concentrattion by region #cleveland by state ggplot(newdata, aes(x = TotalRate, y = reorder(STATE, TotalRate),color=REGION)) + geom_point(size = 3) + theme_bw() + theme( panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.major.y = element_line(colour = &quot;grey60&quot;, linetype = &quot;dashed&quot;))+ ggtitle(&quot;Cleveland Dot Plot of All Gender Cancer Region&quot;) ggplot(newdata, aes(x = TotalSO2, y = reorder(STATE, TotalSO2),color=REGION)) + geom_point(size = 3) + theme_bw() + theme( panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.major.y = element_line(colour = &quot;grey60&quot;, linetype = &quot;dashed&quot;))+ ggtitle(&quot;Cleveland Dot Plot of Mean SO2 Concentration&quot;) ggplot(newdata, aes(x = TotalNO3, y = reorder(STATE, TotalNO3),color=REGION)) + geom_point(size = 3) + theme_bw() + theme( panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), panel.grid.major.y = element_line(colour = &quot;grey60&quot;, linetype = &quot;dashed&quot;))+ ggtitle(&quot;Cleveland Dot Plot of Mean NO3 Concentration&quot;) * Remarks: + The distributions of regions in the above 3 plots have the same pattern: East and West region have higher cancer rate and pollutants’ concentrations. Middle region have the lowest cancer rate and pollutants’ concentrations. + There is a high chance that Lung and Bronchus cancer rate and pollutants’ concentrations are correlated. ##Correlation matrix with visualizations ggpairs(newdata[8:12], title=&quot;correlogram with ggpairs()&quot;)+ ggtitle(&quot;Correlogram of Each Pair of the Indicators&quot;) ggcorr(newdata[8:12], method = c(&quot;everything&quot;, &quot;pearson&quot;)) + ggtitle(&quot;Heatmap of Correlations&quot;) #more related to SO2 than NO3 Remarks: The Corr values of TotalSO2 and TotalRate, TotalSO2 and FemaleRate, TotalSO2 and MaleRate are statistical significantly correlated. The heatmap also shows that the cancer rates are more related to SO2 compared to NO3. ##Is there a difference between female cancer rate and male cancer rate? tidy_data &lt;- pivot_longer(combined, cols=c(&quot;FemaleRate&quot;, &quot;MaleRate&quot;), names_to = &quot;SEX&quot;, values_to = &quot;RATE&quot;, values_drop_na = TRUE) ggplot(tidy_data,aes(RATE,group=1))+ geom_boxplot()+ facet_grid(rows=vars(SEX))+ ggtitle(&quot;The Distribution of Cancer Rate Faceted by SEX&quot;) * Remarks: + The boxplots show that males tend to have a higher Lung and Bronchus cancer incident rate compare to females in general in the US. + For female’s rate, there is one state as an outlier. "],["interactive-component.html", "Chapter 7 Interactive component", " Chapter 7 Interactive component Cancer Rate by State path:hover { fill-opacity: .7; } body { font-family: \"Open Sans\", sans-serif; font-size: 16px; padding: 40px; } h1{ font-size: 3em; font-weight: 700; color: #0E6251; } .states { stroke: #fff; stroke-width:1px; } .d3-tip { line-height: 1; padding: 12px; background: rgba(43,43,43, 0.8); color: #fff; border-radius: 2px; } "],["conclusion.html", "Chapter 8 Conclusion", " Chapter 8 Conclusion "]]
